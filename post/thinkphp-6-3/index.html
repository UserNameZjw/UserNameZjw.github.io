<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>ã€ŒThinkPHP 6.0ã€æ§åˆ¶å™¨éªŒè¯ä¸å“åº” | ã€Œè°¨è¨€æ…è¡Œã€</title>
<meta name="description" content="ä¸€ä½å¹´è¿‘ä¸‰åçš„ä¸­å¹´æ²¹è…»è‚¥èƒ–è€ç”·äººçš„ä¸­å¹´å±æœº">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://UserNameZjw.github.io/favicon.ico?v=1560840658341">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://UserNameZjw.github.io/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />



  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://UserNameZjw.github.io">
        <img src="https://UserNameZjw.github.io/images/avatar.png?v=1560840658341" class="site-logo">
        <h1 class="site-title">ã€Œè°¨è¨€æ…è¡Œã€</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      ä¸€ä½å¹´è¿‘ä¸‰åçš„ä¸­å¹´æ²¹è…»è‚¥èƒ–è€ç”·äººçš„ä¸­å¹´å±æœº
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://UserNameZjw.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">ã€ŒThinkPHP 6.0ã€æ§åˆ¶å™¨éªŒè¯ä¸å“åº”</h2>
            <div class="post-date">2019-06-16</div>
            
              <div class="feature-container" style="background-image: url('https://UserNameZjw.github.io/post-images/thinkphp-6-3.jpg')">
              </div>
            
            <div class="post-content">
              <p>æ§åˆ¶å™¨éªŒè¯<br>
å“åº”</p>
<!-- more -->
<h3 id="controller-åŸºç±»ç»§æ‰¿å¼•ç”¨">Controller åŸºç±»ç»§æ‰¿å¼•ç”¨</h3>
<p>é€šè¿‡ç»§æ‰¿ BaseController åŸºç±»ï¼Œæ³¨å…¥ app ä»¥åŠ request<br>
æœ¬æ–‡ä»…ä¸¾ä¸¤ä¸ªæµ…æ˜¾çš„è°ƒç”¨ä¾‹å­<br>
1.è·å–å½“å‰æ“ä½œå  $action = $this-&gt;request-&gt;action();<br>
2.è·å–å½“å‰åº”ç”¨åŸºç¡€ç›®å½•  $path = $this-&gt;app-&gt;getBasePath();<br>
<img src="https://UserNameZjw.github.io/post-images/1560679805511.png" alt=""><br>
ç®€æ˜“ä»£ç  â†“</p>
<pre><code>&lt;?php
namespace app\index\controller;

use app\BaseController;

class Index extends BaseController
{
    public function index()
    {
        //è·å–å½“å‰æ“ä½œå
        echo $action = $this-&gt;request-&gt;action();
        echo '&lt;br&gt;è·å–å½“å‰æ“ä½œåä»£ç  ï¼š$action = $this-&gt;request-&gt;action();&lt;br&gt; ';
        // è·å–å½“å‰åº”ç”¨åŸºç¡€ç›®å½•
        echo $path = $this-&gt;app-&gt;getBasePath();
        echo '&lt;br&gt;è·å–å½“å‰åº”ç”¨åŸºç¡€ç›®å½• ï¼š$path = $this-&gt;app-&gt;getBasePath();&lt;br&gt; ';
        echo &quot;ä»¥ä¸Šä¸¤ä¸ªè°ƒç”¨ request app å‡é€šè¿‡åŸºç±» BaseController.php æ³¨å…¥&lt;br&gt;&quot;;
        echo &quot;åªéœ€ç»§æ‰¿ BaseController ç±»å³å¯è°ƒç”¨&quot;;
    }
}
</code></pre>
<p>æ³¨æ„ï¼š<br>
å¦‚æœä½ æ˜¯å¤šåº”ç”¨æ¨¡å¼ï¼Œå¯ä»¥åœ¨ åº”ç”¨ç›®å½•ä¸‹åŒæ ·åˆ›å»ºä¸€ä¸ª BaseController.php åŸºç±»æ–‡ä»¶<br>
ThinkPHP 6 åœ¨å¯»å€çš„æ—¶å€™ï¼Œä¼˜å…ˆå°±è¿‘åŸåˆ™ã€‚</p>
<h3 id="æ§åˆ¶å™¨éªŒè¯">æ§åˆ¶å™¨éªŒè¯</h3>
<p>å‚è€ƒèµ„æ–™ï¼š<a href="https://www.kancloud.cn/manual/thinkphp6_0/1037629">TP6 å®˜æ–¹å†…ç½®è§„åˆ™</a><br>
1.é€šè¿‡å¼•ç”¨ validate å‡½æ•°ç›´æ¥åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨<br>
Validate(è§„åˆ™,è¿”å›æç¤º)-&gt;check(æ•°æ®)<br>
è¿™ä¸ªç®€å•ï¼Œå°±ä¸åšè¿‡å¤šä»‹ç»</p>
<pre><code>&lt;?php
namespace app\index\controller;

class Validate
{ 
    public function index ()
    {
        //å®šä¹‰éªŒè¯è§„åˆ™
        $rule = [
            'name' =&gt; &quot;require|max:10&quot;,
            'email' =&gt; &quot;email&quot;
        ];

        // å®šä¹‰é”™è¯¯è¿”å›ä¿¡æ¯

        $message = [
            &quot;name&quot; =&gt; [&quot;require&quot; =&gt; 'åç§°ä¸èƒ½ä¸ºç©º','max' =&gt; 'åç§°æœ€å¤§é•¿åº¦ä¸º10'],
            'email' =&gt; 'é‚®ç®±æ ¼å¼é”™è¯¯'
        ];

        // å®šä¹‰æ¨¡æ‹Ÿæ•°æ®
        $data = [
            'name' =&gt; 'Cry',
            'email' =&gt; 'snail@qq.com'
        ];

        // éªŒè¯è§„åˆ™
        // Validate(è§„åˆ™,è¿”å›æç¤º)-&gt;check(æ•°æ®)
        $result = Validate($rule,$message)-&gt;check($data);

        if(!$result){
            // è·å–æŠ¥é”™æ•°æ®
            return Validate()-&gt;getError();
        }else{
            return 'éªŒè¯é€šè¿‡';
        }
    }
}
</code></pre>
<p>2.é€šè¿‡å¼•ç”¨ validate å¯¹è±¡ç›´æ¥åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨<br>
ç»§æ‰¿åŸºç±» BaseController ç±»<br>
$this-&gt;validate(æ•°æ®,éªŒè¯è§„åˆ™,è¿”å›æç¤º);</p>
<pre><code>&lt;?php
namespace app\index\controller;

use app\BaseController;

class Validate extends BaseController
{ 
    public function index ()
    {
        //å®šä¹‰éªŒè¯è§„åˆ™
        $rule = [
            'name' =&gt; &quot;require|max:10&quot;,
            'email' =&gt; &quot;email&quot;
        ];

        // å®šä¹‰é”™è¯¯è¿”å›ä¿¡æ¯

        $message = [
            &quot;name&quot; =&gt; [&quot;require&quot; =&gt; 'åç§°ä¸èƒ½ä¸ºç©º','max' =&gt; 'åç§°æœ€å¤§é•¿åº¦ä¸º10'],
            'email' =&gt; 'é‚®ç®±æ ¼å¼é”™è¯¯'
        ];

        // å®šä¹‰æ¨¡æ‹Ÿæ•°æ®
        $data = [
            'name' =&gt; 'Cry',
            'email' =&gt; 'snail@qq.com'
        ];

        // éªŒè¯è§„åˆ™
        $result = $this-&gt;validate($data,$rule,$message);

        if(!$result){
            // è·å–æŠ¥é”™æ•°æ®
            return Validate()-&gt;getError();
        }else{
            return 'éªŒè¯é€šè¿‡';
        }
    }
}
</code></pre>
<p>3.è‡ªå®šä¹‰éªŒè¯è§„åˆ™<br>
éªŒè¯ä¸‹å›¾è¦æ±‚(å‡ä½¿ç”¨ ThinkPHP6 å†…ç½®è§„åˆ™)<br>
<img src="https://UserNameZjw.github.io/post-images/1560694503550.png" alt=""><br>
1.éœ€è¦é¢å¤–åˆ›å»ºä¸€ä¸ªéªŒè¯æ–‡ä»¶</p>
<blockquote>
<p>åœ¨ app ç›®å½•ä¸‹åˆ›å»º validate æ–‡ä»¶å¤¹ï¼Œç„¶ååˆ›å»º User.php æ–‡ä»¶ä½œä¸ºè‡ªå®šä¹‰è§„åˆ™æ–‡ä»¶ã€‚</p>
</blockquote>
<p>ç›®å½•ï¼šapp\validate\User .php ä»£ç å¦‚ä¸‹ â†“<br>
æ³¨æ„ä»£ç æ ¼å¼ï¼Œä¸éœ€è¦åˆ›å»ºæ–¹æ³•ï¼Œç›´æ¥å†™éªŒè¯è§„åˆ™å’ŒéªŒè¯è¿”å›å³å¯<br>
ç”¨ protected å£°æ˜</p>
<pre><code>&lt;?php
namespace app\validate;

use think\Validate;

class User extends Validate
{
    protected $rule = [
        'user_name' =&gt; 'require|chsAlphaNum|length:6,10',
        'password' =&gt; 'require|alphaNum|length:6,10',
        'email' =&gt; 'email',
        'mobile' =&gt; 'require|mobile|number|length:11'
    ];

    protected $message = [
        'user_name' =&gt; ['require' =&gt; 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º','chsAlphaNum' =&gt; 'ç”¨æˆ·åå¿…é¡»ä¸ºå­—æ¯å’Œæ•°å­—æˆ–æ±‰å­—','length' =&gt; 'ç”¨æˆ·åé•¿åº¦åº”åœ¨6è‡³10ä½'],
        'password' =&gt; ['require' =&gt; 'å¯†ç ä¸èƒ½ä¸ºç©º','alphaNum' =&gt; 'å¯†ç å¿…é¡»ä¸ºæ•°å­—å’Œå­—æ¯ç»„åˆ','length' =&gt; 'å¯†ç é•¿åº¦åº”åœ¨6è‡³10ä½'],
        'email' =&gt; ['email' =&gt; 'é‚®ç®±æ ¼å¼æœ‰è¯¯'],
        'mobile' =&gt; ['require' =&gt; 'æ‰‹æœºä¸èƒ½ä¸ºç©º','number' =&gt; 'æ‰‹æœºå·å¿…é¡»ä¸ºæ•°å­—','length' =&gt; 'æ‰‹æœºå·é•¿åº¦å¿…é¡»11ä½','mobile' =&gt; 'ä¸æ˜¯å¯ç”¨æ‰‹æœºå·']
    ];
}
</code></pre>
<p>2.åœ¨ app\index\controller\Index.php ä¸‹è°ƒç”¨<br>
å¼•å…¥ User.php ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ â†“</p>
<pre><code>&lt;?php
namespace app\index\controller;

use app\BaseController;
use app\validate\User;

class Index extends BaseController
{
    public function index()
    {
        $data = [
            'user_name' =&gt; 'Cry666è¶…å¸…çš„',
            'password' =&gt; '123456qwe',
            'email' =&gt; 'snail@qq.com',
            'mobile' =&gt; '13112121211'
        ];

        $result = Validate(User::class)-&gt;check($data);

        if(!$result){
            // è·å–æŠ¥é”™æ•°æ®
            return Validate()-&gt;getError();
        }else{
            return 'éªŒè¯é€šè¿‡';
        }
    }
}
</code></pre>
<h3 id="å“åº”">å“åº”</h3>
<p>å‚è€ƒèµ„æ–™ï¼š<a href="https://www.kancloud.cn/manual/thinkphp6_0/1037526">TP6 å®˜æ–¹å“åº”è¾“å‡º</a><br>
é™¤äº†è·¯ç”±ï¼Œéœ€è¦æ³¨æ„çš„å¯èƒ½å°±æ˜¯é‡å®šå‘äº†<br>
1.é‡å®šå‘<br>
å‚è€ƒèµ„æ–™ï¼š<a href="https://www.kancloud.cn/manual/thinkphp6_0/1037528">TP6 å®˜æ–¹é‡å®šå‘</a><br>
åªéœ€è¦è°ƒç”¨ redirect(URL) å‡½æ•° å³å¯<br>
ä¸Šä¸€ä¸ªå®˜æ–¹ä¾‹å­ä»£ç â†“</p>
<pre><code>&lt;?php
namespace app\controller;

class Index
{
    public function hello()
    {
        return redirect('http://www.thinkphp.cn');
    }
}
</code></pre>
<p>å…¶ä»–ä½¿ç”¨æ¨¡å¼ï¼Œæ¯”å¦‚ä¼ å€¼ã€å›æº¯åˆ°åŸç½‘é¡µç­‰æ“ä½œï¼Œè¯·è‡ªè¡Œçœ‹æ–‡æ¡£å­¦ä¹ ğŸ¤£ğŸ¤£ğŸ¤£</p>

            </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://UserNameZjw.github.io/post/thinkphp-6-2">
                  <h3 class="post-title">
                    ã€ŒThinkPHP 6.0ã€éƒ¨åˆ†é…ç½®ä¸æ§åˆ¶å™¨
                  </h3>
                </a>
              </div>
            

            
              
                <div id="gitalk-container" data-aos="fade-in"></div>
              

              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>



  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '19e99227bee7425b84fe',
        clientSecret: 'fd6e22f86390c0075ff9db20e16c5221d27dbf9f',
        repo: 'UserNameZjw.github.io',
        owner: 'UserNameZjw',
        admin: ['UserNameZjw'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
